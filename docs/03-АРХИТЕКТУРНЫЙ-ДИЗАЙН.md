# üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ô –î–ò–ó–ê–ô–ù

## –ü—Ä–æ–µ–∫—Ç: CurRate-Go

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 22 –¥–µ–∫–∞–±—Ä—è 2025  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–î–µ—Ç–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω –º–æ–¥—É–ª–µ–π](#–¥–µ—Ç–∞–ª—å–Ω—ã–π-–¥–∏–∑–∞–π–Ω-–º–æ–¥—É–ª–µ–π)
4. [–î–∏–∞–≥—Ä–∞–º–º—ã](#–¥–∏–∞–≥—Ä–∞–º–º—ã)
5. [–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã](#–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã-–∏-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã)
6. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∏-–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

**Layered Architecture (–ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞) —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**

```mermaid
graph TB
    subgraph "Presentation Layer"
        GUI[GUI Layer<br/>Wails v2<br/>HTML/CSS/JS]
    end
    
    subgraph "Business Logic Layer"
        CONV[Converter<br/>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç]
        VAL[Validator<br/>–í–∞–ª–∏–¥–∞—Ü–∏—è]
        FMT[Formatter<br/>–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    end
    
    subgraph "Data Access Layer"
        PARSER[Parser<br/>XML API –¶–ë –†–§]
        CACHE[Cache<br/>LRU —Å TTL]
    end
    
    subgraph "External"
        CBR[CBR XML API<br/>–¶–ë –†–§]
    end
    
    GUI --> CONV
    CONV --> VAL
    CONV --> FMT
    CONV --> CACHE
    CONV --> PARSER
    PARSER --> CBR
    CACHE --> CONV
    
    style GUI fill:#4da6ff,stroke:#0066cc,color:white
    style CONV fill:#10b981,stroke:#059669,color:white
    style PARSER fill:#f59e0b,stroke:#d97706,color:white
    style CACHE fill:#8b5cf6,stroke:#7c3aed,color:white
    style CBR fill:#ef4444,stroke:#dc2626,color:white
```

### 1.2. –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- ‚úÖ **Separation of Concerns** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **Dependency Injection** - –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- ‚úÖ **Interface Segregation** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- ‚úÖ **Single Responsibility** - –æ–¥–∏–Ω –º–æ–¥—É–ª—å = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- ‚úÖ **Don't Repeat Yourself (DRY)** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—ã
- ‚úÖ **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã** - –≤—Å–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 2.1. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
currate-go/
‚îÇ
‚îú‚îÄ‚îÄ cmd/                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îÇ   ‚îî‚îÄ‚îÄ currate/
‚îÇ       ‚îî‚îÄ‚îÄ main.go
‚îÇ
‚îú‚îÄ‚îÄ internal/                     # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–¥ (–Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ currency.go          # –¢–∏–ø Currency, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–∏–º–≤–æ–ª—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ currency_test.go     # –¢–µ—Å—Ç—ã (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rate.go              # ExchangeRate, ConversionResult, RateData
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rate_test.go         # –¢–µ—Å—Ç—ã (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ converter/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ converter.go         # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Å DI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ converter_test.go    # –¢–µ—Å—Ç—ã (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validator.go          # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatter.go         # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ parser/                   # –ü–∞—Ä—Å–∏–Ω–≥ XML API –¶–ë –†–§
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cbr.go               # –ü—É–±–ª–∏—á–Ω—ã–π API (FetchRates)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cbr_test.go           # Unit —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cbr_integration_test.go # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.go             # HTTP –∫–ª–∏–µ–Ω—Ç —Å retry
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client_test.go        # –¢–µ—Å—Ç—ã HTTP –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xml.go                # XML –ø–∞—Ä—Å–∏–Ω–≥ (encoding/xml)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xml_test.go           # –¢–µ—Å—Ç—ã XML –ø–∞—Ä—Å–∏–Ω–≥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xml_additional_test.go # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser.go             # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parser_test.go        # –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ cache/                    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ       ‚îú‚îÄ‚îÄ lru.go                # LRU –∫—ç—à —Å TTL (thread-safe)
‚îÇ       ‚îî‚îÄ‚îÄ lru_test.go           # –¢–µ—Å—Ç—ã (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
‚îÇ
‚îú‚îÄ‚îÄ pkg/                          # –ü—É–±–ª–∏—á–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îî‚îÄ‚îÄ utils/                     # –£—Ç–∏–ª–∏—Ç—ã –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ number.go             # –ü–∞—Ä—Å–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
‚îÇ       ‚îî‚îÄ‚îÄ number_test.go        # –¢–µ—Å—Ç—ã (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
‚îÇ
‚îú‚îÄ‚îÄ docs/                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ 01-–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï-–ó–ê–î–ê–ù–ò–ï.md
‚îÇ   ‚îú‚îÄ‚îÄ 02-–¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô-–°–¢–ï–ö.md
‚îÇ   ‚îú‚îÄ‚îÄ 03-–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ô-–î–ò–ó–ê–ô–ù.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ go.mod                        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ go.sum                        # Checksums
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ LICENSE
```

### 2.2. –†–∞–∑–º–µ—Ä –∏ scope —Ñ–∞–π–ª–æ–≤

| –ú–æ–¥—É–ª—å | –§–∞–π–ª—ã | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | –°—Ç–∞—Ç—É—Å |
|--------|-------|------------|------------------|--------|
| `internal/models` | 2 —Ñ–∞–π–ª–∞ | ~150 | 100.0% ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| `internal/converter` | 3 —Ñ–∞–π–ª–∞ | ~300 | 100.0% ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| `internal/parser` | 9 —Ñ–∞–π–ª–æ–≤ | ~600 | 94.2% ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| `internal/cache` | 2 —Ñ–∞–π–ª–∞ | ~200 | 100.0% ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| `pkg/utils` | 2 —Ñ–∞–π–ª–∞ | ~150 | 100.0% ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| **–ò–¢–û–ì–û** | **18 —Ñ–∞–π–ª–æ–≤** | **~1400** | **97.2%** ‚úÖ | **–ì–æ—Ç–æ–≤–æ** |

---

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω –º–æ–¥—É–ª–µ–π

### 3.1. Module: `internal/models`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –º–µ—Ç–æ–¥–æ–≤

#### `models/currency.go`

```go
package models

// Currency –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–∏–ø –≤–∞–ª—é—Ç—ã
type Currency string

// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–∞–ª—é—Ç—ã
const (
    USD Currency = "USD" // –î–æ–ª–ª–∞—Ä –°–®–ê
    EUR Currency = "EUR" // –ï–≤—Ä–æ
    RUB Currency = "RUB" // –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å
)

// Validate –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–∞–ª—é—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–π
func (c Currency) Validate() error {
    switch c {
    case USD, EUR, RUB:
        return nil
    default:
        return fmt.Errorf("%w: %s", ErrUnsupportedCurrency, c)
    }
}

// Symbol –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏–º–≤–æ–ª –≤–∞–ª—é—Ç—ã ($, ‚Ç¨, ‚ÇΩ)
func (c Currency) Symbol() string {
    switch c {
    case USD: return "$"
    case EUR: return "‚Ç¨"
    case RUB: return "‚ÇΩ"
    default: return string(c)
    }
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RUB (—É–ª—É—á—à–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å Python –≤–µ—Ä—Å–∏–µ–π)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∞–ª—é—Ç
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –∏ –Ω–∞–∑–≤–∞–Ω–∏–π
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

#### `models/rate.go`

```go
package models

import "time"

// ExchangeRate –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã –¶–ë –†–§
type ExchangeRate struct {
    Currency Currency  // –í–∞–ª—é—Ç–∞
    Rate     float64   // –ö—É—Ä—Å –∫ —Ä—É–±–ª—é
    Nominal  int       // –ù–æ–º–∏–Ω–∞–ª (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü –≤–∞–ª—é—Ç—ã)
    Date     time.Time // –î–∞—Ç–∞ –∫—É—Ä—Å–∞
}

// ConversionResult –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç—ã
type ConversionResult struct {
    SourceCurrency Currency  // –ò—Å—Ö–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞
    TargetCurrency Currency  // –¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞ (–≤—Å–µ–≥–¥–∞ RUB)
    SourceAmount   float64   // –ò—Å—Ö–æ–¥–Ω–∞—è —Å—É–º–º–∞
    TargetAmount   float64   // –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
    Rate           float64   // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∫—É—Ä—Å
    Date           time.Time // –î–∞—Ç–∞ –∫—É—Ä—Å–∞
    FormattedStr   string    // –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
}

// RateData –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫—É—Ä—Å–∞—Ö –≤–∞–ª—é—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–∞—Ç—É
type RateData struct {
    Date  time.Time                 // –î–∞—Ç–∞ –∫—É—Ä—Å–∞
    Rates map[Currency]ExchangeRate // –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç (–∫–ª—é—á - –≤–∞–ª—é—Ç–∞)
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã (`time.Time` –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫)
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—É—Ä—Å–∞—Ö (–Ω–æ–º–∏–Ω–∞–ª, –¥–∞—Ç–∞)
- ‚úÖ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (`NewRateData`, `AddRate`, `GetRate`)
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

---

### 3.2. Module: `internal/parser`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç —Å XML API –¶–ë –†–§

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–µ—Ä–∞

```mermaid
graph LR
    A[FetchRates] --> B[buildURL]
    A --> C[fetchRatesFromURL]
    C --> D[fetchXML]
    C --> E[ParseXML]
    D --> F[HTTP Client]
    F --> G[Retry Logic]
    E --> H[XML Parser]
    E --> I[Windows-1251 Decoder]
    
    style A fill:#10b981,stroke:#059669,color:white
    style D fill:#f59e0b,stroke:#d97706,color:white
    style E fill:#8b5cf6,stroke:#7c3aed,color:white
```

#### `parser/cbr.go` - –ü—É–±–ª–∏—á–Ω—ã–π API

```go
package parser

import (
    "time"
    "github.com/bivlked/currate-go/internal/models"
)

// FetchRates –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç —Å —Å–∞–π—Ç–∞ –¶–ë –†–§ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É
// date - –¥–∞—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç *models.RateData —Å –∫—É—Ä—Å–∞–º–∏ –≤–∞–ª—é—Ç –∏–ª–∏ –æ—à–∏–±–∫—É
func FetchRates(date time.Time) (*models.RateData, error) {
    url := buildURL(date)
    return fetchRatesFromURL(url, date)
}

// FetchLatestRates –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç
func FetchLatestRates() (*models.RateData, error) {
    return FetchRates(time.Now())
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π XML API –¶–ë –†–§
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –≤–∞–ª—é—Ç—ã (–Ω–µ —Ç–æ–ª—å–∫–æ USD/EUR)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ windows-1251 ‚Üí UTF-8
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff

#### `parser/client.go` - HTTP –∫–ª–∏–µ–Ω—Ç

```go
package parser

import (
    "net/http"
    "time"
)

const (
    CBRURL = "https://www.cbr.ru/scripts/XML_daily.asp"
    DefaultTimeout = 10 * time.Second
    MaxRetries = 3
    BaseRetryDelay = 1 * time.Second
)

// fetchXML –≤—ã–ø–æ–ª–Ω—è–µ—Ç HTTP GET –∑–∞–ø—Ä–æ—Å —Å retry –ª–æ–≥–∏–∫–æ–π –∏ exponential backoff
func fetchXML(url string) (io.ReadCloser, error) {
    client := newHTTPClient()
    
    var lastErr error
    for attempt := 1; attempt <= MaxRetries; attempt++ {
        resp, err := doRequest(client, url)
        if err == nil {
            return resp.Body, nil
        }
        
        lastErr = err
        if attempt < MaxRetries {
            delay := BaseRetryDelay * time.Duration(1<<uint(attempt-1))
            sleepFunc(delay) // 1s, 2s, 4s
        }
    }
    
    return nil, fmt.Errorf("max retries exceeded: %w", lastErr)
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ Exponential backoff (1s, 2s, 4s)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ User-Agent –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### `parser/xml.go` - XML –ø–∞—Ä—Å–∏–Ω–≥

```go
package parser

import (
    "encoding/xml"
    "golang.org/x/text/encoding/charmap"
)

// ValCurs –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç XML –æ—Ç–≤–µ—Ç–∞ –¶–ë –†–§
type ValCurs struct {
    XMLName xml.Name `xml:"ValCurs"`
    Date    string   `xml:"Date,attr"`
    Name    string   `xml:"name,attr"`
    Valutes []Valute `xml:"Valute"`
}

// Valute –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç–µ
type Valute struct {
    ID       string `xml:"ID,attr"`
    CharCode string `xml:"CharCode"`
    Nominal  int    `xml:"Nominal"`
    Value    string `xml:"Value"` // –°—Ç—Ä–æ–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π
}

// ParseXML –ø–∞—Ä—Å–∏—Ç XML –æ—Ç–≤–µ—Ç –¶–ë –†–§
func ParseXML(r io.Reader, date time.Time) (*models.RateData, error) {
    xmlData, err := io.ReadAll(r)
    if err != nil {
        return nil, fmt.Errorf("failed to read XML: %w", err)
    }
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è windows-1251 ‚Üí UTF-8
    if bytes.Contains(xmlData, []byte("windows-1251")) {
        decoder := charmap.Windows1251.NewDecoder()
        xmlData, err = decoder.Bytes(xmlData)
        // ...
    }
    
    // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ XML
    var valCurs ValCurs
    if err := xml.Unmarshal(xmlData, &valCurs); err != nil {
        return nil, fmt.Errorf("invalid XML: %w", err)
    }
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ models.RateData
    // ...
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É `encoding/xml`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è windows-1251 ‚Üí UTF-8
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–º–∏–Ω–∞–ª–∞ –≤–∞–ª—é—Ç
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–Ω–∞—á–µ–Ω–∏–π —Å –∑–∞–ø—è—Ç–æ–π (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)

---

### 3.3. Module: `internal/cache`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** LRU –∫—ç—à —Å TTL –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### `cache/lru.go` - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è LRU –∫—ç—à–∞

```go
package cache

import (
    "container/list"
    "sync"
    "time"
    "github.com/bivlked/currate-go/internal/models"
)

// LRUCache - –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π LRU –∫—ç—à —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π TTL
type LRUCache struct {
    mu      sync.RWMutex
    cache   map[string]*list.Element // –•—ç—à-—Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è O(1) –¥–æ—Å—Ç—É–ø–∞
    lru     *list.List               // –î–≤—É—Å–≤—è–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è LRU –ø–æ—Ä—è–¥–∫–∞
    maxSize int                      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
    ttl     time.Duration            // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∑–∞–ø–∏—Å–∏
}

// Entry - –∑–∞–ø–∏—Å—å –≤ –∫—ç—à–µ
type Entry struct {
    key       string
    rate      float64
    timestamp time.Time
}

// NewLRUCache —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π LRU –∫—ç—à
func NewLRUCache(maxSize int, ttl time.Duration) *LRUCache {
    return &LRUCache{
        cache:   make(map[string]*list.Element),
        lru:     list.New(),
        maxSize: maxSize,
        ttl:     ttl,
    }
}

// Get –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å –∏–∑ –∫—ç—à–∞
func (c *LRUCache) Get(currency models.Currency, date time.Time) (float64, bool) {
    c.mu.Lock()
    defer c.mu.Unlock()
    
    key := c.makeKey(currency, date)
    elem, exists := c.cache[key]
    if !exists {
        return 0, false
    }
    
    entry := elem.Value.(*Entry)
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL
    if time.Since(entry.timestamp) > c.ttl {
        c.lru.Remove(elem)
        delete(c.cache, key)
        return 0, false
    }
    
    // –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü (LRU)
    c.lru.MoveToBack(elem)
    return entry.rate, true
}

// Set —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—É—Ä—Å –≤ –∫—ç—à
func (c *LRUCache) Set(currency models.Currency, date time.Time, rate float64) {
    c.mu.Lock()
    defer c.mu.Unlock()
    
    key := c.makeKey(currency, date)
    
    // –ï—Å–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–±–Ω–æ–≤–∏—Ç—å
    if elem, exists := c.cache[key]; exists {
        entry := elem.Value.(*Entry)
        entry.rate = rate
        entry.timestamp = time.Now()
        c.lru.MoveToBack(elem)
        return
    }
    
    // –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –µ—Å–ª–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω
    if c.lru.Len() >= c.maxSize {
        oldest := c.lru.Front()
        if oldest != nil {
            c.lru.Remove(oldest)
            delete(c.cache, oldest.Value.(*Entry).key)
        }
    }
    
    // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
    entry := &Entry{
        key:       key,
        rate:      rate,
        timestamp: time.Now(),
    }
    elem := c.lru.PushBack(entry)
    c.cache[key] = elem
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ Thread-safe (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `sync.RWMutex`)
- ‚úÖ LRU –∞–ª–≥–æ—Ä–∏—Ç–º —Å O(1) –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (map + list)
- ‚úÖ TTL –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –ë–µ–Ω—á–º–∞—Ä–∫–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- –†–∞–∑–º–µ—Ä: 100 –∑–∞–ø–∏—Å–µ–π
- TTL: 24 —á–∞—Å–∞

---

### 3.4. Module: `internal/converter`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç

#### `converter/converter.go` - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä

```go
package converter

import (
    "time"
    "github.com/bivlked/currate-go/internal/models"
)

// RateProvider - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
type RateProvider interface {
    FetchRates(date time.Time) (*models.RateData, error)
}

// CacheStorage - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–æ–≤
type CacheStorage interface {
    Get(currency models.Currency, date time.Time) (float64, bool)
    Set(currency models.Currency, date time.Time, rate float64)
    Clear()
}

// Converter - –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
type Converter struct {
    provider RateProvider
    cache    CacheStorage
}

// NewConverter —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç
func NewConverter(provider RateProvider, cache CacheStorage) *Converter {
    if cache == nil {
        cache = noopCache{} // –ó–∞–≥–ª—É—à–∫–∞ –µ—Å–ª–∏ –∫—ç—à –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω
    }
    
    return &Converter{
        provider: provider,
        cache:    cache,
    }
}

// Convert –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å—É–º–º—É –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç–µ –≤ —Ä—É–±–ª–∏
func (c *Converter) Convert(amount float64, currency models.Currency, date time.Time) (*models.ConversionResult, error) {
    if c.provider == nil {
        return nil, ErrNilRateProvider
    }
    
    normalizedDate := normalizeDate(date)
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    if err := ValidateAmount(amount); err != nil {
        return nil, err
    }
    if err := currency.Validate(); err != nil {
        return nil, err
    }
    if err := ValidateDate(normalizedDate); err != nil {
        return nil, err
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ RUB (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ API)
    if currency == models.RUB {
        return &models.ConversionResult{
            SourceCurrency: currency,
            TargetCurrency: models.RUB,
            SourceAmount:   amount,
            TargetAmount:   amount,
            Rate:           1,
            Date:           normalizedDate,
            FormattedStr:   FormatResult(amount, 1, currency, amount),
        }, nil
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ (—Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à)
    rate, found := c.cache.Get(currency, normalizedDate)
    if !found {
        // –ö—É—Ä—Å–∞ –Ω–µ—Ç –≤ –∫—ç—à–µ - –ø–æ–ª—É—á–∞–µ–º —á–µ—Ä–µ–∑ provider
        rateData, err := c.provider.FetchRates(normalizedDate)
        if err != nil {
            return nil, fmt.Errorf("failed to fetch rates: %w", err)
        }
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫—É—Ä—Å –¥–ª—è –Ω—É–∂–Ω–æ–π –≤–∞–ª—é—Ç—ã
        exchangeRate, exists := rateData.Rates[currency]
        if !exists {
            return nil, fmt.Errorf("currency %s not found in rates", currency)
        }
        
        rate = exchangeRate.Rate
        if exchangeRate.Nominal > 1 {
            rate = rate / float64(exchangeRate.Nominal)
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
        c.cache.Set(currency, normalizedDate, rate)
    }
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
    resultRUB := amount * rate
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    formatted := FormatResult(amount, rate, currency, resultRUB)
    
    return &models.ConversionResult{
        SourceCurrency: currency,
        TargetCurrency: models.RUB,
        SourceAmount:   amount,
        TargetAmount:   resultRUB,
        Rate:           rate,
        Date:           normalizedDate,
        FormattedStr:   formatted,
    }, nil
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è DI (—Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å)
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ RUB –≤–∞–ª—é—Ç—ã (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ API)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–º–∏–Ω–∞–ª–∞ –≤–∞–ª—é—Ç
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

#### `converter/validator.go` - –í–∞–ª–∏–¥–∞—Ü–∏—è

```go
package converter

import (
    "errors"
    "time"
)

var (
    ErrInvalidAmount = errors.New("—Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    ErrDateInFuture  = errors.New("–¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º")
)

// ValidateAmount –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—É–º–º—ã
func ValidateAmount(amount float64) error {
    if amount <= 0 {
        return ErrInvalidAmount
    }
    return nil
}

// ValidateDate –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
// –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–º –¥–∞—Ç–∞–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω–µ
func ValidateDate(date time.Time) error {
    normalized := normalizeDate(date)
    normalizedInLocal := normalized.In(time.Local)
    dateYear, dateMonth, dateDay := normalizedInLocal.Date()
    
    nowLocal := time.Now()
    nowYear, nowMonth, nowDay := nowLocal.Date()
    
    if dateYear > nowYear ||
        (dateYear == nowYear && dateMonth > nowMonth) ||
        (dateYear == nowYear && dateMonth == nowMonth && dateDay > nowDay) {
        return ErrDateInFuture
    }
    return nil
}

func normalizeDate(date time.Time) time.Time {
    return time.Date(date.Year(), date.Month(), date.Day(), 0, 0, 0, 0, date.Location())
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã (—Ç–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º)

#### `converter/formatter.go` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```go
package converter

import (
    "fmt"
    "strings"
    "github.com/bivlked/currate-go/internal/models"
)

// FormatResult —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
// –§–æ—Ä–º–∞—Ç: "80 722,00 —Ä—É–±. ($1 000,00 –ø–æ –∫—É—Ä—Å—É 80,7220)"
func FormatResult(amount, rate float64, currency models.Currency, resultRUB float64) string {
    resultStr := formatNumber(resultRUB)
    amountStr := formatNumber(amount)
    
    rateStr := fmt.Sprintf("%.4f", rate)
    rateStr = strings.ReplaceAll(rateStr, ".", ",")
    
    symbol := currency.Symbol()
    
    return fmt.Sprintf("%s —Ä—É–±. (%s%s –ø–æ –∫—É—Ä—Å—É %s)",
        resultStr, symbol, amountStr, rateStr)
}

// formatNumber —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á (–ø—Ä–æ–±–µ–ª) –∏ –∑–∞–ø—è—Ç–æ–π
func formatNumber(num float64) string {
    str := fmt.Sprintf("%.2f", num)
    str = strings.ReplaceAll(str, ".", ",")
    
    parts := strings.Split(str, ",")
    intPart := parts[0]
    decPart := parts[1]
    
    intPart = addThousandsSeparator(intPart)
    
    return intPart + "," + decPart
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç —á–∏—Å–µ–ª (–ø—Ä–æ–±–µ–ª - —Ç—ã—Å—è—á–∏, –∑–∞–ø—è—Ç–∞—è - –¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å)
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ (4 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç—É Python –≤–µ—Ä—Å–∏–∏

---

### 3.5. Module: `pkg/utils`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –£—Ç–∏–ª–∏—Ç—ã –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

#### `utils/number.go` - –ü–∞—Ä—Å–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª

```go
package utils

// ParseAmount –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫—É —Å —Å—É–º–º–æ–π –≤ float64
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
// - "1000" - —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
// - "1 000" - —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Ç—ã—Å—è—á
// - "1,000.50" - –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç
// - "1.000,50" - –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç
// - "1000.50" - –ø—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç —Å —Ç–æ—á–∫–æ–π
// - "1000,50" - –ø—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç —Å –∑–∞–ø—è—Ç–æ–π
func ParseAmount(input string) (float64, error) {
    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥
    // ...
}

// FormatAmount —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ –≤ —Å—Ç—Ä–æ–∫—É —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á
func FormatAmount(amount float64, decimals int) string {
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω—É–∂–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    // ...
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —á–∏—Å–µ–ª
- ‚úÖ –£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ (–∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π/–µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π)
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

---

## üìä –î–∏–∞–≥—Ä–∞–º–º—ã

### 4.1. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã

```mermaid
sequenceDiagram
    participant User
    participant GUI as GUI Layer<br/>(Wails v2)
    participant Converter
    participant Cache as LRU Cache
    participant Parser
    participant CBR as CBR XML API

    User->>GUI: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö<br/>(amount, currency, date)
    User->>GUI: –ù–∞–∂–∞—Ç–∏–µ "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"
    
    GUI->>Converter: Convert(amount, currency, date)
    
    Converter->>Converter: normalizeDate(date)
    Converter->>Converter: ValidateAmount(amount)
    Converter->>Converter: ValidateDate(date)
    
    alt RUB –≤–∞–ª—é—Ç–∞
        Converter->>Converter: –í–æ–∑–≤—Ä–∞—Ç –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ API
    else –î—Ä—É–≥–∞—è –≤–∞–ª—é—Ç–∞
        Converter->>Cache: Get(currency, normalizedDate)
        
        alt Cache Hit
            Cache-->>Converter: rate, true
        else Cache Miss
            Cache-->>Converter: 0, false
            Converter->>Parser: FetchRates(normalizedDate)
            
            Parser->>Parser: buildURL(date)
            Parser->>Parser: fetchXML(url)
            
            loop Retry (max 3 –ø–æ–ø—ã—Ç–∫–∏)
                Parser->>CBR: HTTP GET (XML API)
                alt Success
                    CBR-->>Parser: XML (windows-1251)
                    Parser->>Parser: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è UTF-8
                    Parser->>Parser: ParseXML(body, date)
                    Parser-->>Converter: RateData
                else Error
                    Parser->>Parser: Exponential backoff<br/>(1s, 2s, 4s)
                end
            end
            
            Converter->>Converter: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞<br/>(—Å —É—á–µ—Ç–æ–º –Ω–æ–º–∏–Ω–∞–ª–∞)
            Converter->>Cache: Set(currency, date, rate)
        end
        
        Converter->>Converter: result = amount * rate
        Converter->>Converter: FormatResult(...)
    end
    
    Converter-->>GUI: ConversionResult
    GUI->>User: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

### 4.2. –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```mermaid
graph TB
    subgraph "Models Layer"
        CURR[Currency]
        RATE[ExchangeRate<br/>ConversionResult<br/>RateData]
    end
    
    subgraph "Converter Layer"
        CONV[Converter]
        VAL[Validator]
        FMT[Formatter]
    end
    
    subgraph "Parser Layer"
        CBR_API[CBR API]
        XML[XML Parser]
        CLIENT[HTTP Client]
    end
    
    subgraph "Cache Layer"
        LRU[LRU Cache]
    end
    
    CONV --> CURR
    CONV --> RATE
    CONV --> VAL
    CONV --> FMT
    CONV --> LRU
    CONV --> CBR_API
    CBR_API --> XML
    CBR_API --> CLIENT
    
    style CONV fill:#10b981,stroke:#059669,color:white
    style LRU fill:#8b5cf6,stroke:#7c3aed,color:white
    style CBR_API fill:#f59e0b,stroke:#d97706,color:white
```

### 4.3. –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

```mermaid
stateDiagram-v2
    [*] --> Idle: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    
    Idle --> Validating: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ
    Validating --> Valid: –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
    Validating --> Invalid: –î–∞–Ω–Ω—ã–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
    
    Valid --> CheckingCache: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
    CheckingCache --> CacheHit: –ö—É—Ä—Å –≤ –∫—ç—à–µ
    CheckingCache --> CacheMiss: –ö—É—Ä—Å–∞ –Ω–µ—Ç –≤ –∫—ç—à–µ
    
    CacheMiss --> Fetching: –ó–∞–ø—Ä–æ—Å –∫ API
    Fetching --> Success: –£—Å–ø–µ—à–Ω–æ
    Fetching --> Error: –û—à–∏–±–∫–∞ —Å–µ—Ç–∏
    
    CacheHit --> Formatting: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    Success --> Formatting
    Formatting --> DisplayResult: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    
    Invalid --> Idle: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    Error --> Idle: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
    
    DisplayResult --> Idle: –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
```

---

## üîå –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### 5.1. Interface: `RateProvider`

```go
// RateProvider - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
// –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
type RateProvider interface {
    // FetchRates –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É
    // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç RateData —Å –∫–∞—Ä—Ç–æ–π –∫—É—Ä—Å–æ–≤ –∏–ª–∏ –æ—à–∏–±–∫—É
    FetchRates(date time.Time) (*models.RateData, error)
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ `parser.FetchRates` - —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –¶–ë –†–§ (—Ñ—É–Ω–∫—Ü–∏—è, –Ω–µ —Ç–∏–ø)
- ‚úÖ `MockRateProvider` (–≤ —Ç–µ—Å—Ç–∞—Ö) - –º–æ–∫ –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–µ—Ç–æ–¥)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –≤–∞–ª—é—Ç—ã –Ω–∞ –¥–∞—Ç—É (–Ω–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É)
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –º–æ–∫–∞–º–∏

### 5.2. Interface: `CacheStorage`

```go
// CacheStorage - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–æ–≤
// –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
type CacheStorage interface {
    // Get –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å –∏–∑ –∫—ç—à–∞
    Get(currency models.Currency, date time.Time) (float64, bool)
    
    // Set —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—É—Ä—Å –≤ –∫—ç—à
    Set(currency models.Currency, date time.Time, rate float64)
    
    // Clear –æ—á–∏—â–∞–µ—Ç –≤–µ—Å—å –∫—ç—à
    Clear()
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ `cache.LRUCache` - —Ä–µ–∞–ª—å–Ω—ã–π LRU –∫—ç—à —Å TTL
- ‚úÖ `noopCache` (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) - –ø—É—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Å–ª—É—á–∞–µ–≤ –±–µ–∑ –∫—ç—à–∞
- ‚úÖ `MockCacheStorage` (–≤ —Ç–µ—Å—Ç–∞—Ö) - –º–æ–∫ –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (3 –º–µ—Ç–æ–¥–∞)
- Thread-safe —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (`LRUCache`)
- –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à (`noopCache`)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

### 6.1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞

```go
package parser

const (
    // CBRURL - –±–∞–∑–æ–≤—ã–π URL XML API –¶–ë –†–§
    CBRURL = "https://www.cbr.ru/scripts/XML_daily.asp"
    
    // DefaultTimeout - —Ç–∞–π–º–∞—É—Ç –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
    DefaultTimeout = 10 * time.Second
    
    // MaxRetries - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
    MaxRetries = 3
    
    // BaseRetryDelay - –±–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è exponential backoff
    BaseRetryDelay = 1 * time.Second
    
    // UserAgent - User-Agent –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
    UserAgent = "CurRate-Go/2.0 (Windows; Go; XML)"
)
```

### 6.2. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫—ç—à–∞

```go
package cache

// –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
const (
    DefaultMaxSize = 100        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
    DefaultTTL     = 24 * time.Hour // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∑–∞–ø–∏—Å–∏
)
```

### 6.3. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞

```go
package converter

// –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
var (
    ErrInvalidAmount = errors.New("—Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    ErrDateInFuture  = errors.New("–¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º")
    ErrNilRateProvider = errors.New("–∏—Å—Ç–æ—á–Ω–∏–∫ –∫—É—Ä—Å–æ–≤ –Ω–µ –∑–∞–¥–∞–Ω")
)
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 7.1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**Unit —Ç–µ—Å—Ç—ã:**
- ‚úÖ `converter` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å –º–æ–∫–∞–º–∏
- ‚úÖ `parser` - –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML
- ‚úÖ `cache` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ LRU –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏ TTL
- ‚úÖ `validator` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ `models` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `utils` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**Integration —Ç–µ—Å—Ç—ã:**
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ XML API –¶–ë –†–§ (—Å —Ç–µ–≥–æ–º `integration`)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∫–∏ Converter + Parser + Cache

**Benchmark —Ç–µ—Å—Ç—ã:**
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å LRU –∫—ç—à–∞
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞ XML

### 7.2. –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

| –ú–æ–¥—É–ª—å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å |
|--------|----------|--------|
| `internal/models` | 100.0% | ‚úÖ |
| `internal/converter` | 100.0% | ‚úÖ |
| `internal/cache` | 100.0% | ‚úÖ |
| `pkg/utils` | 100.0% | ‚úÖ |
| `internal/parser` | 94.2% | ‚úÖ |
| **–û–±—â–µ–µ** | **97.2%** | ‚úÖ |

### 7.3. –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞

```go
func TestConverter_Convert(t *testing.T) {
    mockProvider := &MockRateProvider{
        rateData: &models.RateData{
            Date: date,
            Rates: map[models.Currency]models.ExchangeRate{
                models.USD: {
                    Currency: models.USD,
                    Rate:     80.7220,
                    Nominal:  1,
                    Date:     date,
                },
            },
        },
    }
    
    cache := cache.NewLRUCache(100, 24*time.Hour)
    converter := converter.NewConverter(mockProvider, cache)
    
    result, err := converter.Convert(1000, models.USD, date)
    
    assert.NoError(t, err)
    assert.Equal(t, 80722.0, result.TargetAmount)
    assert.Contains(t, result.FormattedStr, "80 722,00 —Ä—É–±.")
}
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è DI

**–†–µ—à–µ–Ω–∏–µ:** `Converter` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ `RateProvider` –∏ `CacheStorage`, –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –í—ã—Å–æ–∫–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (–ª–µ–≥–∫–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –º–æ–∫–∏)
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- ‚úÖ –ù–∏–∑–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

### 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç

**–†–µ—à–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è `normalizeDate` –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞—Ç—ã (—É–±–∏—Ä–∞–µ—Ç –≤—Ä–µ–º—è) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞—Ç—ã —Å —Ä–∞–∑–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º ‚Üí –æ–¥–∏–Ω –∫–ª—é—á –∫—ç—à–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å–∞

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ RUB –≤–∞–ª—é—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:** –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ RUB –≤ `Converter.Convert` –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ API.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RUB ‚Üí RUB (–±–µ–∑ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å Python –≤–µ—Ä—Å–∏–µ–π

### 4. XML API –≤–º–µ—Å—Ç–æ HTML –ø–∞—Ä—Å–∏–Ω–≥–∞

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ XML API –¶–ë –†–§ –≤–º–µ—Å—Ç–æ HTML scraping.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API)
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (~10x –±—ã—Å—Ç—Ä–µ–µ)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

### 5. Thread-safe –∫—ç—à

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sync.RWMutex` –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ LRU –∫—ç—à–∞.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è (RWMutex)

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å HTML –ø–∞—Ä—Å–∏–Ω–≥–æ–º

| –ú–µ—Ç–æ–¥ | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|-------|---------------|-----------|
| HTML –ø–∞—Ä—Å–∏–Ω–≥ (goquery) | ~50-100 –º—Å | baseline |
| **XML API (encoding/xml)** | **~5-10 –º—Å** | **10x –±—ã—Å—Ç—Ä–µ–µ** |

### Benchmarks LRU Cache

```
BenchmarkLRUCache_Set-8           500000    2547 ns/op    336 B/op    5 allocs/op
BenchmarkLRUCache_Get-8          1000000    1023 ns/op      0 B/op    0 allocs/op
BenchmarkLRUCache_Concurrent-8    200000    7891 ns/op    672 B/op   10 allocs/op
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GUI (Wails v2)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```mermaid
graph TB
    subgraph "Frontend (HTML/CSS/JS)"
        UI[User Interface]
    end
    
    subgraph "Wails Runtime"
        BIND[Wails Bindings<br/>–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è]
    end
    
    subgraph "Backend (Go)"
        APP[App Struct<br/>Wails Methods]
        CONV[Converter<br/>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥]
    end
    
    UI -->|JavaScript Calls| BIND
    BIND -->|Go Method Calls| APP
    APP -->|Uses| CONV
    
    style UI fill:#4da6ff,stroke:#0066cc,color:white
    style BIND fill:#f59e0b,stroke:#d97706,color:white
    style APP fill:#10b981,stroke:#059669,color:white
    style CONV fill:#8b5cf6,stroke:#7c3aed,color:white
```

### –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```go
// app.go - Wails App —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
type App struct {
    ctx       context.Context
    converter *converter.Converter
}

// ConvertCurrency - –º–µ—Ç–æ–¥, –¥–æ—Å—Ç—É–ø–Ω—ã–π –∏–∑ JavaScript
func (a *App) ConvertCurrency(amount float64, currency string, dateStr string) (*models.ConversionResult, error) {
    // –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    curr := models.Currency(currency)
    date, err := time.Parse("02.01.2006", dateStr)
    if err != nil {
        return nil, err
    }
    
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ Converter
    return a.converter.Convert(amount, curr, date)
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ (Converter, Parser, Cache)
- ‚úÖ –¢–æ–Ω–∫–∏–π —Å–ª–æ–π –∞–¥–∞–ø—Ç–µ—Ä–∞ (App struct)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–Ω–¥–∏–Ω–≥–æ–≤ Wails

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CurRate-Go –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö:

1. ‚úÖ **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –∏–º–µ–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É
2. ‚úÖ **Dependency Injection** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
3. ‚úÖ **–í—ã—Å–æ–∫–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≤—Å–µ –º–æ–¥—É–ª–∏ –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –º–æ–∫–∞–º–∏
4. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - XML API, LRU –∫—ç—à, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
5. ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - retry –ª–æ–≥–∏–∫–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–û—Ü–µ–Ω–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** Ivan Bondarev (BiV)  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 19.12.2025  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 22.12.2025 (v2.0 - –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π)
