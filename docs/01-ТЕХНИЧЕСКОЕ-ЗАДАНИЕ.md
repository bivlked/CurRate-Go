# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Проект: CurRate - Standalone Windows приложение для конвертации валют

**Версия документа:** 2.0  
**Дата:** 19 декабря 2025  
**Обновлено:** 22 декабря 2025  
**Автор:** Ivan Bondarev (BiV)

---

## 1. ВВЕДЕНИЕ

### 1.1. Цель проекта
Разработка компактного standalone Windows приложения для конвертации валют в рубли по официальным курсам Центрального Банка РФ на заданную дату.

**Поддерживаемые валюты:**
- **UI (пользовательский интерфейс):** USD, EUR
- **Backend API:** USD, EUR, RUB

**Примечание:** RUB не доступен в UI, так как конвертация RUB→RUB не имеет практического смысла. Однако backend API поддерживает RUB для совместимости и возвращает курс 1.0.

### 1.2. Предпосылки
Существующее Python приложение требует:
- Установки Python 3.14+
- Установки Poetry и зависимостей
- Клонирования репозитория
- Настройки виртуального окружения

**Проблема:** Неудобно для конечных пользователей на Windows 11.

**Решение:** Создать standalone exe-файл, который:
- Не требует установки Python или других зависимостей
- Запускается двойным кликом
- Имеет компактный размер (5-10 MB)
- Имеет привычный Windows-интерфейс

### 1.3. Текущее решение (Python)
- **Язык:** Python 3.14
- **GUI:** Tkinter + tkcalendar
- **HTTP:** requests + BeautifulSoup4
- **Кэш:** OrderedDict (LRU)
- **Размер:** ~500 KB исходников + ~100 MB runtime (Python + библиотеки)

### 1.4. Новое решение (Go)
- **Язык:** Go 1.25.5
- **GUI:** Wails v2.11.0 (HTML/CSS/JS + Go backend)
- **HTTP:** net/http (встроенный)
- **XML парсинг:** encoding/xml (стандартная библиотека) + golang.org/x/text для windows-1251
- **Кэш:** Custom LRU с TTL (thread-safe)
- **Целевой размер exe:** 8-10 MB (один файл, с UPX компрессией)

---

## 2. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 2.1. Основной функционал

#### FR-1: Выбор даты
- **Приоритет:** ВЫСОКИЙ
- **Описание:** Пользователь может выбрать дату курса через календарь
- **Детали:**
  - Календарный виджет для визуального выбора даты
  - Текстовое поле с датой в формате DD.MM.YYYY
  - Синхронизация виджета и текстового поля
  - По умолчанию: текущая дата
  - Валидация: дата не должна быть в будущем
  - Формат даты: DD.MM.YYYY (например, 19.12.2025)

#### FR-2: Выбор валюты
- **Приоритет:** ВЫСОКИЙ
- **Описание:** Пользователь выбирает валюту для конвертации
- **Детали:**
  - Радио-кнопки для выбора валюты
  - Поддерживаемые валюты: USD, EUR (UI); USD, EUR, RUB (Backend API)
  - По умолчанию: USD
  - Визуальная индикация выбранной валюты

#### FR-3: Ввод суммы
- **Приоритет:** ВЫСОКИЙ
- **Описание:** Пользователь вводит сумму для конвертации
- **Детали:**
  - Текстовое поле для ввода числа
  - Поддержка различных форматов:
    - `1000` (без разделителей)
    - `1 000` (с пробелами)
    - `1,000.50` (с запятой как разделитель тысяч)
    - `1000,50` (с запятой как десятичный разделитель)
  - Автоматическая нормализация ввода
  - Валидация: только положительные числа

#### FR-4: Получение курса ЦБ РФ
- **Приоритет:** ВЫСОКИЙ
- **Описание:** Получение официального курса с XML API ЦБ РФ
- **Детали:**
  - URL: `https://www.cbr.ru/scripts/XML_daily.asp?date_req={date}`
  - Парсинг XML ответа с курсами (encoding/xml)
  - Обработка кодировки windows-1251 → UTF-8 (golang.org/x/text)
  - Обработка номинала валюты (для правильного расчета курса за 1 единицу)
  - Retry-логика при сетевых ошибках (3 попытки с экспоненциальной задержкой: 1s, 2s, 4s)
  - Timeout: 10 секунд на запрос
  - Производительность: ~5-10 мс (в 10 раз быстрее HTML парсинга)

#### FR-5: Конвертация валюты
- **Приоритет:** ВЫСОКИЙ
- **Описание:** Расчет суммы в рублях
- **Детали:**
  - Формула: `Результат = Сумма × Курс`
  - Учет номинала валюты (курс рассчитывается за 1 единицу валюты)
  - Точность: до 2 знаков после запятой

#### FR-6: Отображение результата
- **Приоритет:** ВЫСОКИЙ
- **Описание:** Форматированный вывод результата конвертации
- **Детали:**
  - Формат: `{сумма в руб.} руб. (${исходная сумма} по курсу {курс})`
  - Пример: `85 000,00 руб. ($1 000,00 по курсу 85,0000)`
  - Разделитель тысяч: пробел
  - Десятичный разделитель: запятая
  - Символ валюты: `$` для USD, `€` для EUR

#### FR-7: Копирование в буфер обмена
- **Приоритет:** СРЕДНИЙ
- **Описание:** Копирование результата в clipboard одной кнопкой
- **Детали:**
  - Кнопка "Копировать в буфер"
  - Копируется полная строка результата
  - Визуальное подтверждение (всплывающее сообщение)
  - Кнопка активна только когда есть результат

#### FR-8: Кэширование курсов
- **Приоритет:** СРЕДНИЙ
- **Описание:** Локальное кэширование полученных курсов
- **Детали:**
  - LRU (Least Recently Used) кэш
  - Максимум записей: 100
  - TTL (Time To Live): 24 часа
  - Ключ кэша: `(валюта, дата)`
  - При повторном запросе той же пары - использовать кэш вместо HTTP

### 2.2. Дополнительные возможности

#### FR-9: Обработка ошибок
- **Приоритет:** ВЫСОКИЙ
- **Описание:** Понятные сообщения об ошибках для пользователя
- **Детали:**
  - Ошибка сети: "Не удалось подключиться к серверу ЦБ РФ. Проверьте подключение к интернету"
  - Timeout: "Превышено время ожидания ответа от сервера"
  - Некорректная дата: "Некорректный формат даты. Используйте DD.MM.YYYY"
  - Дата в будущем: "Дата не может быть в будущем"
  - Валюта не найдена: "Курс валюты не найден для указанной даты"
  - Некорректная сумма: "Некорректное значение суммы"

#### FR-10: Асинхронная загрузка
- **Приоритет:** СРЕДНИЙ
- **Описание:** Не блокировать UI во время HTTP запроса
- **Детали:**
  - Запрос выполняется в отдельной goroutine
  - Индикация загрузки: текст "Получаю курс..."
  - Блокировка кнопки конвертации во время запроса
  - Обновление UI после завершения запроса

---

## 3. НЕФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 3.1. Производительность

#### NFR-1: Размер приложения
- **Требование:** Размер exe-файла не более 10 MB
- **Целевое значение:** 5-7 MB
- **Метод проверки:** `dir currate.exe` (Windows) или `ls -lh currate.exe`

#### NFR-2: Время запуска
- **Требование:** Приложение должно запускаться менее чем за 2 секунды
- **Целевое значение:** < 1 секунда
- **Метод проверки:** Измерение времени от запуска до отображения окна

#### NFR-3: Время отклика
- **Требование:** Время получения курса не более 5 секунд (без учета сетевых задержек)
- **Целевое значение:** < 2 секунды
- **Метод проверки:** Логирование времени выполнения HTTP запроса

#### NFR-4: Использование памяти
- **Требование:** Потребление RAM не более 100 MB
- **Целевое значение:** 30-50 MB
- **Метод проверки:** Task Manager (Windows) / Process Explorer

### 3.2. Совместимость

#### NFR-5: Операционная система
- **Требование:** Windows 10 (22H2+) / Windows 11
- **Архитектура:** x86-64 (AMD64)
- **Метод проверки:** Тестирование на целевых ОС

#### NFR-6: Разрешение экрана
- **Требование:** Поддержка разрешений от 1280×720 и выше
- **Адаптивность:** Фиксированный размер окна с минимальными размерами
- **Метод проверки:** Тестирование на различных разрешениях

### 3.3. Безопасность

#### NFR-7: Сетевые соединения
- **Требование:** Использование только HTTPS для cbr.ru
- **Валидация:** Проверка SSL сертификатов
- **Метод проверки:** Анализ сетевого трафика (Wireshark)

#### NFR-8: Хранение данных
- **Требование:** Никаких персональных данных не сохраняется
- **Кэш:** Только курсы валют (публичная информация)
- **Метод проверки:** Проверка файловой системы и реестра

### 3.4. Удобство использования

#### NFR-9: Интерфейс
- **Требование:** Нативный Windows вид (стандартные контролы)
- **Язык:** Русский (без интернационализации в v1.0)
- **Метод проверки:** Экспертная оценка UX

#### NFR-10: Установка
- **Требование:** Не требует установки (portable exe)
- **Запуск:** Двойной клик по exe-файлу
- **Метод проверки:** Тестирование на чистой Windows 11

### 3.5. Надежность

#### NFR-11: Обработка ошибок
- **Требование:** Приложение не должно падать при любых пользовательских действиях
- **Recovery:** Graceful degradation при сетевых ошибках
- **Метод проверки:** Стресс-тестирование, отключение сети

#### NFR-12: Логирование
- **Требование:** Опциональное логирование для отладки
- **Формат:** Текстовый лог-файл рядом с exe (если включено)
- **Метод проверки:** Проверка содержимого лог-файла

---

## 4. ТЕХНОЛОГИЧЕСКИЙ СТЕК

### 4.1. Язык программирования
- **Основной:** Go 1.25.5
- **Обоснование:** Простота, быстрая компиляция, статическая линковка

### 4.2. GUI фреймворк
- **Основной:** Wails v2.11.0
- **Версия:** v2.11.0 (latest stable)
- **Обоснование:** 
  - Современный подход: Go backend + HTML/CSS/JS frontend
  - Использует нативный WebView2 (встроен в Windows 11)
  - Отличная производительность
  - Простая связка Go ↔ JavaScript через автоматический биндинг
  - Размер exe 8-10 MB после UPX сжатия

### 4.3. Библиотеки

| Компонент | Библиотека | Назначение |
|-----------|------------|------------|
| GUI | `github.com/wailsapp/wails/v2` | Desktop UI фреймворк (Wails v2) |
| HTTP клиент | `net/http` (std) | HTTP запросы |
| XML парсинг | `encoding/xml` (std) | Парсинг XML ответа ЦБ РФ |
| Кодировки | `golang.org/x/text/encoding/charmap` | Конвертация windows-1251 → UTF-8 |
| Буфер обмена | `github.com/atotto/clipboard` | Работа с clipboard |
| Дата/время | `time` (std) | Работа с датами |
| Кэш | Custom LRU (`container/list` + `sync.RWMutex`) | Кэширование курсов (thread-safe) |

### 4.4. Инструменты разработки
- **Сборка:** `go build` (встроенный)
- **Управление зависимостями:** Go modules (встроенный)
- **Тестирование:** `go test` (встроенный)
- **Форматирование:** `go fmt` (встроенный)
- **Линтер:** `golangci-lint`
- **Компрессия:** UPX (опционально, для уменьшения размера exe)

---

## 5. ОГРАНИЧЕНИЯ И ДОПУЩЕНИЯ

### 5.1. Ограничения
- Только Windows (нет macOS/Linux в v1.0)
- Только русский язык интерфейса
- UI поддерживает только USD и EUR (Backend API также поддерживает RUB)
- Только конвертация в рубли (не из рублей)
- Нет оффлайн режима (требуется интернет)

### 5.2. Допущения
- XML API ЦБ РФ доступен и стабилен
- У пользователя есть доступ к интернету
- Пользователь использует Windows 10/11 (WebView2 Runtime доступен)
- Системное время пользователя настроено правильно

---

## 6. КРИТЕРИИ ПРИЕМКИ

### 6.1. Основные критерии
- ✅ Приложение запускается на Windows 11 без установки
- ✅ Размер exe-файла не более 10 MB
- ✅ Все функциональные требования (FR-1 до FR-10) реализованы
- ✅ Интерфейс идентичен текущему Python приложению по функциональности
- ✅ Обработка всех типов ошибок с понятными сообщениями
- ✅ Кэширование работает корректно

### 6.2. Дополнительные критерии
- ✅ Код покрыт unit-тестами (минимум 70%)
- ✅ Код проходит линтер без ошибок
- ✅ Документация для пользователя (README)
- ✅ Документация для разработчика (код + комментарии)

---

## 7. РИСКИ И МИТИГАЦИЯ

### 7.1. Технические риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Изменение XML API ЦБ РФ | Низкая | Среднее | Использование официального API, интеграционные тесты |
| Проблемы с GUI библиотекой Wails | Низкая | Среднее | Wails v2 - стабильный фреймворк, активная поддержка |
| Превышение размера exe | Низкая | Низкое | UPX компрессия, оптимизация сборки (целевой размер достигнут) |
| Проблемы совместимости с Windows 10 | Низкая | Среднее | WebView2 автоустановка на Windows 10, тестирование |

### 7.2. Проектные риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Недостаток опыта команды с Go | Средняя | Среднее | Обучение, менторство, proof of concept |
| Изменение требований | Низкая | Среднее | Фиксация scope, change control |

---

## 8. ГЛОССАРИЙ

- **ЦБ РФ** - Центральный Банк Российской Федерации
- **LRU** - Least Recently Used (алгоритм вытеснения кэша)
- **TTL** - Time To Live (время жизни записи в кэше)
- **Standalone** - Самостоятельное приложение без зависимостей
- **Portable** - Не требует установки
- **Retry-логика** - Автоматические повторы при ошибках
- **Graceful degradation** - Корректная деградация функциональности при ошибках

---

## 9. ПРИЛОЖЕНИЯ

### 9.1. Пример использования

**Сценарий:** Конвертация 1000 USD в рубли по курсу на 15.12.2025

1. Пользователь запускает `currate.exe`
2. Выбирает дату 15.12.2025 в календаре
3. Оставляет выбранной валюту USD (по умолчанию)
4. Вводит `1000` в поле суммы
5. Нажимает "Конвертировать"
6. Видит результат: `85 000,00 руб. ($1 000,00 по курсу 85,0000)`
7. Нажимает "Копировать в буфер"
8. Видит подтверждение: "Результат скопирован в буфер обмена"
9. Вставляет результат в Excel/Word (Ctrl+V)

### 9.2. Примеры форматов ввода суммы

| Ввод пользователя | Распознанное значение | Валидность |
|-------------------|----------------------|-----------|
| `1000` | 1000.00 | ✅ |
| `1 000` | 1000.00 | ✅ |
| `1,000.50` | 1000.50 | ✅ |
| `1000,50` | 1000.50 | ✅ |
| `1.000,50` | 1000.50 | ✅ |
| `-100` | ERROR | ❌ (отрицательное) |
| `abc` | ERROR | ❌ (не число) |
| `0` | ERROR | ❌ (ноль) |

---

**Конец документа**

---

**Утверждено:**  
Ivan Bondarev (BiV)  
**Дата создания:** 19.12.2025  
**Обновлено:** 22.12.2025 (v2.0 - актуализация: Wails v2, XML API, RUB валюта)
